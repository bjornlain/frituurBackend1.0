FROM node:alpine AS builder
RUN apk update && apk upgrade

WORKDIR /codious_maximus
COPY . .

RUN npm i -g @angular/cli

RUN npm run install:client
RUN npm run client:prod


FROM nginx:alpine
RUN apk update && apk upgrade

COPY /client/nginx.conf /etc/nginx/nginx.conf
COPY --from=builder /codious_maximus/dist /usr/share/nginx/html